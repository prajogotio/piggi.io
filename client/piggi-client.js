!function(){function t(t,e){this.x=t,this.y=e}function e(t){return Math.atan2(t.y,t.x)/Math.PI*180}function i(t,e){var i=t.copy().normalize(),s=t.length(),a=Math.min(e,s);return t.x=i.x*a,t.y=i.y*a,t}function s(t){this.lessThan=t,this.size=0,this.root=null}function a(t){this.value=t,this.left=null,this.right=null,this.parent=null}function o(){this.stackIn=[],this.stackOut=[]}function n(t,e,i,a){function o(t,s,o,n,r){var l=t+o,c=s+n;if(!(0>l||0>c||l>=i.height||c>=i.width)){var d=l*i.width+c,m=Math.abs(e[0]-l)+Math.abs(e[1]-c);if(a)for(var u=0;u<a.length;++u){var g=Math.abs(a[u][0]-l)+Math.abs(a[u][1]-c);m>g&&(m=g)}h[d]>0||0!=i.data[d]&&p.push({cost:r+1+m,par:t*i.width+s,dist:r+1,pos:[l,c]})}}if(t[0]<0||t[1]<0||t[0]>=i.height||t[1]>=i.width||e[0]<0||e[1]<0||e[0]>=i.height||e[1]>=i.width)return[];if(a){for(var n=[],r=0;r<a.length;++r)0!=i.data[a[r][0]*i.width+a[r][1]]&&n.push(a[r]);a=n}var h=new Int32Array(i.data.length),l=new Int32Array(i.data.length).fill(-1),c=function(t,e){return t.cost<e.cost},p=new s(c);h[i.width*t.row+t.col]=1,p.push({cost:0,dist:0,par:-1,pos:t});for(var d=-1,m=1e9;p.size>0;){var u=p.top();p.pop();var g=u.pos[0],f=u.pos[1],y=u.dist,v=g*i.width+f;if(!h[v]){h[v]=1,l[v]=u.par;var E=Math.abs(e[0]-g)+Math.abs(e[1]-f);if(m>=E&&(m=E,d=v),g==e[0]&&f==e[1]){d=v;break}if(a){for(var A=!1,r=0;r<a.length;++r)if(a[r][0]==g&&a[r][1]==f){d=v,A=!0;break}if(A)break}o(g,f,-1,0,y),o(g,f,1,0,y),o(g,f,0,-1,y),o(g,f,0,1,y)}}var I=[];if(-1!=d)for(;-1!=d;){var g=Math.floor(d/i.width),f=d-g*i.width;I.push([g,f]),d=l[d]}return I}function r(e,i){for(var s=[],a=0;a<e.length;++a)s.push(new t((e[a][1]+.5)*i.size,(e[a][0]+.5)*i.size));return s}function h(t,e,i,s,a,o,n){this.DELTA_PER_FRAME=Math.ceil(n/jt.SCALER),this.delta=0,this.currentFrame=0,this.numOfFrames=o,this.imgBuffer=t,this.offsetX=e,this.offsetY=i,this.width=s,this.height=a,this.autoReset=!0}function l(e,i,s){this.STANDBY=0,this.MOVING=1,this.ATTACKING=2,this.EATING=3,this.DEAD=4,this.FLOCK_AGGRESIVENESS=200,this.BUILDING_AGGRESIVENESS=640,this.RADIUS_OF_ACCEPTANCE=4,this.MAXIMUM_SPEED=1.5*jt.SCALER,this.AVOIDANCE_SPEED=1.5*jt.SCALER,this.TARGET_RADIUS=64,this.steeringEffect=2.4*jt.SCALER,this.attackRadius=32,this.MOVING_TARGET=!0,this.mass=e,this.radius=s||32,this.invMass=0==e?0:1/e,this.pos=i,this.force=new t(0,0),this.steeringForce=new t(0,0),this.velocity=new t(0,0),this.orientation=0,this.target=null,this.targetStack=[],this.pathTimestamp=-1,this.state=this.STANDBY,this.ENVIRONMENT_CHECK_DELAY=80,this.lastEnvironmentCheck=-10,this.updateCount=0,this.lockOnTarget=null,this.lastAttack=0,this.ATTACK_DELAY=80/jt.SCALER,this.team=0,this.healthPoints=100,this.isAlive=!0,this.strength=30,this.maxHealthPoints=100,this.provoked=!1,this.PERSISTENCE=1e3/jt.SCALER,this.timeOfDeath=-1,this.INTEGRATE_ONLY_MAX_COUNTER=10/jt.SCALER,this.integrateOnlyCounter=10/jt.SCALER}function c(t,e,i){l.call(this,t,e,i),this.sprites={}}function p(e,i){this.size=e,this.radius=e/2,this.pos=new t(0,0),this.row=null,this.col=null,this.NORMAL=0,this.DEAD=1,this.ATTACK_TYPE=0,this.EAT_TYPE=1,this.NO_INTERACTION=2,this.SHOW_HEALTHBAR=!0,this.MOVING_TARGET=!1,this.ACTIVE=0,this.PASSIVE=1,this.sprites={},this.state=this.NORMAL,this.interactionDistance=i,this.interactionType=this.ATTACK_TYPE,this.activity=this.ACTIVE,this.MAX_INTERACTION=6,this.interactionCount=0,this.attackRadius=500,this.ATTACK_DELAY=130,this.strength=80,this.lastAttack=0,this.team=0,this.healthPoints=500,this.maxHealthPoints=500,this.isAlive=!0,this.updateCount=0,this.PERSISTENCE=120,this.timeOfDeath=-1,this.destroyable=!0}function d(t,e){c.call(this,100,t,32),this.setSprite(this.STANDBY,new h(Yt.images[R("asset/pig_standby.png",e)],0,0,128,128,4,20)),this.setSprite(this.MOVING,new h(Yt.images[R("asset/pig_running.png",e)],0,0,128,128,6,12)),this.setSprite(this.ATTACKING,new h(Yt.images[R("asset/pig_angry.png",e)],0,0,128,128,3,20)),this.setSprite(this.EATING,new h(Yt.images[R("asset/pig_eating.png",e)],0,0,128,128,2,30)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/pig_death.png",e)],0,0,128,128,1,100)),this.sprites[this.ATTACKING].autoReset=!1,this.team=e,this.healthPoints=this.maxHealthPoints=200,this.strength=30}function m(t,e){c.call(this,100,t,32),this.setSprite(this.STANDBY,new h(Yt.images[R("asset/boar_standby.png",e)],0,0,128,128,2,30)),this.setSprite(this.MOVING,new h(Yt.images[R("asset/boar_running.png",e)],0,0,128,128,10,12)),this.setSprite(this.ATTACKING,new h(Yt.images[R("asset/boar_attacking.png",e)],0,0,128,128,3,20)),this.setSprite(this.EATING,new h(Yt.images[R("asset/boar_eating.png",e)],0,0,128,128,2,30)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/boar_death.png",e)],0,0,128,128,1,100)),this.sprites[this.ATTACKING].autoReset=!1,this.team=e,this.healthPoints=this.maxHealthPoints=1200,this.strength=180,this.ATTACK_DELAY=60}function u(t,e,i){p.call(this,128,640),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/tower.png",i)],0,0,128,128,2,25)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/tower_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.type=this.ATTACK_TYPE,this.attackRadius=300,this.ATTACK_DELAY=200/jt.SCALER,this.healthPoints=this.maxHealthPoints=500,this.strength=100,this.team=i,this.MAX_INTERACTION=12,this.weapon=L}function g(t,e,i){p.call(this,128,640),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/castle.png",i)],0,0,128,128,2,25)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/castle_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.type=this.ATTACK_TYPE,this.attackRadius=400,this.ATTACK_DELAY=120/jt.SCALER,this.strength=250,this.healthPoints=this.maxHealthPoints=1800,this.team=i,this.MAX_INTERACTION=12,this.weapon=_}function f(t,e,i){p.call(this,64,128),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/rice_field.png",i)],0,0,128,128,6,200)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/rice_field_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),qt.map.data[t*qt.map.width+e]=1,this.team=i,this.interactionType=this.EAT_TYPE,this.SHOW_HEALTHBAR=!1,this.healthPoints=200,this.PERSISTENCE=300/jt.SCALER,this.MAX_INTERACTION=2,this.radius=0,this.coinsToHarvest=1,this.lastProduce=0,this.PRODUCE_DELAY=200/jt.SCALER}function y(t,e,i){p.call(this,64,128),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/super_rice_field.png",i)],0,0,128,128,6,200)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/rice_field_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),qt.map.data[t*qt.map.width+e]=1,this.team=i,this.interactionType=this.EAT_TYPE,this.SHOW_HEALTHBAR=!1,this.healthPoints=550,this.PERSISTENCE=300/jt.SCALER,this.MAX_INTERACTION=2,this.radius=0,this.coinsToHarvest=3,this.PRODUCE_DELAY=250/jt.SCALER}function v(t,e,i){p.call(this,64,100),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/fence.png",i)],0,0,128,128,1,100)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/fence_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.team=i,this.type=this.ATTACK_TYPE,this.activity=this.PASSIVE,this.SHOW_HEALTHBAR=!1,this.PERSISTENCE=20,this.healthPoints=100,this.MAX_INTERACTION=2}function E(t,e,i){p.call(this,64,100),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/super_fence.png",i)],0,0,128,128,1,100)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/fence_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.team=i,this.type=this.ATTACK_TYPE,this.activity=this.PASSIVE,this.SHOW_HEALTHBAR=!1,this.PERSISTENCE=20,this.healthPoints=this.maxHealthPoints=400,this.MAX_INTERACTION=2}function A(t,e,i){p.call(this,128,300),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/pig_ranch.png",i)],0,0,128,128,2,100)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/pig_ranch_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.team=i,this.type=this.ATTACK_TYPE,this.healthPoints=350,this.maxHealthPoints=350,this.MAX_INTERACTION=8,this.lastProduce=0,this.PRODUCE_DELAY=600/jt.SCALER,this.pigsPerProduction=1,this.product=d,this.productPrice=20}function I(t,e,i){p.call(this,128,300),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/pig_hq.png",i)],0,0,128,128,2,100)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/pig_hq_death.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.team=i,this.type=this.ATTACK_TYPE,this.healthPoints=this.maxHealthPoints=1250,this.MAX_INTERACTION=8,this.lastProduce=0,this.PRODUCE_DELAY=600/jt.SCALER,this.pigsPerProduction=1,this.product=m,this.productPrice=200}function w(t,e,i){p.call(this,128,1e3),this.setSprite(this.NORMAL,new h(Yt.images[R("asset/throne.png",i)],0,0,128,128,6,40)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/throne.png",i)],0,0,128,128,1,100)),T(this,qt.map,t,e),this.team=i,this.type=this.ATTACK_TYPE,this.SHOW_HEALTHBAR=!0,this.PERSISTENCE=700,this.healthPoints=this.maxHealthPoints=5e3,this.MAX_INTERACTION=1e4,this.destroyable=!1}function L(t,i,s){c.call(this,0,t.pos.copy(),32),this.setSprite(this.STANDBY,new h(Yt.images[R("asset/arrow.png",t.team)],0,0,128,128,1,100)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/arrow_death.png",t.team)],0,0,128,128,1,100)),this.target=i,this.owner=t,this.startPoint=t.pos.copy(),this.destination=i.pos.copy(),this.damage=s,this.orientation=e(i.pos.minus(t.pos)),this.updateCount=0,this.maxDelta=40/jt.SCALER}function _(t,i,s){c.call(this,0,t.pos.copy(),45),this.setSprite(this.STANDBY,new h(Yt.images[R("asset/javelin.png",t.team)],0,0,128,128,1,100)),this.setSprite(this.DEAD,new h(Yt.images[R("asset/javelin_death.png",t.team)],0,0,128,128,1,100)),this.target=i,this.owner=t,this.startPoint=t.pos.copy(),this.destination=i.pos.copy(),this.damage=s,this.orientation=e(i.pos.minus(t.pos)),this.updateCount=0,this.maxDelta=40/jt.SCALER}function T(t,e,i,s){for(var a=Math.floor(t.size/e.size),o=0;a>o;++o)for(var n=0;a>n;++n)e.data[(i+o)*e.width+s+n]=0,e.entry[(i+o)*e.width+s+n]=t;t.pos.x=(s+a/2)*e.size,t.pos.y=(i+a/2)*e.size,t.row=i,t.col=s,e.lastUpdated=qt.timestep}function O(t,e){for(var i=Math.floor(t.size/e.size),s=0;i>s;++s)for(var a=0;i>a;++a)e.data[(t.row+s)*e.width+t.col+a]=1,e.entry[(t.row+s)*e.width+t.col+a]=null;e.lastUpdated=qt.timestep}function R(t,e){return e!=Zt.team&&(t+="/b"),t}function k(){this.currentState="BUILD",this.icons=[];var t=[D,M,b,B,N,P,U,z,F,G];this.ICON_SIZE=80;for(var e=0;2>e;++e)for(var i=0;5>i;++i)this.icons.push(new t[5*e+i]((this.ICON_SIZE+2)*i+this.ICON_SIZE/2+3,(this.ICON_SIZE+2)*e+3+this.ICON_SIZE/2,this.ICON_SIZE));this.tower=this.icons[0],this.ranch=this.icons[1],this.farm=this.icons[2],this.fence=this.icons[3],this.upgrade=this.icons[4],this.castle=this.icons[5],this.pighq=this.icons[6],this.garden=this.icons[7],this.wall=this.icons[8],this.deselect=this.icons[9],this.coinInfoSize=40,this.width=5*(this.ICON_SIZE+2)+4,this.height=2*(this.ICON_SIZE+2)+4,this.updatePosition()}function C(t,e,i,s){this.sprite=new h(t,0,0,128,128,1,100),this.state="INACTIVE",this.x=e,this.y=i,this.width=s,this.height=s,this.isLocked=!1,this.cooldown=0,this.MAX_COOL_DOWN=10,this.paid=!1}function S(t,e,i,s,a){C.call(this,t,e,i,s),this.commandType=a,this.isAlive=!0,this.buildingSize=1}function D(t,e,i){S.call(this,Yt.images["asset/tower_icon.png"],t,e,i,"BUILD_TOWER"),this.buildingSize=2,this.tier=qt.towerTier,this.tierCommand="UPGRADE_TOWER",this.MAX_COOL_DOWN=60}function M(t,e,i){S.call(this,Yt.images["asset/ranch_icon.png"],t,e,i,"BUILD_PIG_RANCH"),this.buildingSize=2,this.tier=qt.ranchTier,this.tierCommand="UPGRADE_PIG_RANCH",this.MAX_COOL_DOWN=90}function b(t,e,i){S.call(this,Yt.images["asset/farm_icon.png"],t,e,i,"BUILD_FARM"),this.buildingSize=1,this.MAX_COOL_DOWN=30}function B(t,e,i){S.call(this,Yt.images["asset/fence_icon.png"],t,e,i,"BUILD_FENCE"),this.buildingSize=1,this.MAX_COOL_DOWN=15}function N(t,e,i){C.call(this,Yt.images["asset/upgrade_icon.png"],t,e,i)}function P(t,e,i){S.call(this,Yt.images["asset/castle_icon.png"],t,e,i,"BUILD_CASTLE"),this.buildingSize=2,this.isLocked=!0,this.MAX_COOL_DOWN=80}function U(t,e,i){S.call(this,Yt.images["asset/pighq_icon.png"],t,e,i,"BUILD_PIG_HQ"),this.buildingSize=2,this.isLocked=!0,this.MAX_COOL_DOWN=100}function z(t,e,i){S.call(this,Yt.images["asset/garden_icon.png"],t,e,i,"BUILD_GARDEN"),this.buildingSize=1,this.isLocked=!0,this.MAX_COOL_DOWN=30}function F(t,e,i){S.call(this,Yt.images["asset/wall_icon.png"],t,e,i,"BUILD_WALL"),this.buildingSize=1,this.isLocked=!0,this.MAX_COOL_DOWN=15}function G(t,e,i){C.call(this,Yt.images["asset/deselect_icon.png"],t,e,i),this.state="INACTIVE",this.lockedCoins=0,this.toCancel=!1}function x(t,e,i){for(var s=[];t>0;)s.push(t%10),t=Math.floor(t/10);0==s.length&&(s=[0]),s.reverse();var a=.5*e;return{render:function(t){if("white"==i)for(var o=0;o<s.length;++o)t.drawImage(Yt.images["asset/numbers.png"],128*s[o],0,128,128,o*a-(e-a)/2,0,e,e);else if("green"==i){t.drawImage(Yt.images["asset/plus.png"],0,0,128,128,-(e-a)/2,0,e,e);for(var o=0;o<s.length;++o)t.drawImage(Yt.images["asset/numbers-green.png"],128*s[o],0,128,128,(o+1)*a-(e-a)/2,0,e,e)}else{t.drawImage(Yt.images["asset/minus.png"],0,0,128,128,-(e-a)/2,0,e,e);for(var o=0;o<s.length;++o)t.drawImage(Yt.images["asset/numbers-red.png"],128*s[o],0,128,128,(o+1)*a-(e-a)/2,0,e,e)}},width:a*s.length+("white"!=i?a:0),height:e}}function H(t,e,i,s,a){this.delta=0,this.MAX_DELTA=30,this.pos=t.copy(),this.number=x(e,i,s),this.isAlive=!0,this.team=a}function W(){Zt.canvas=document.getElementById("canvas"),Zt.g=Zt.canvas.getContext("2d"),Qt.LOADING_FRAME=document.getElementById("loading-frame"),Qt.LOGIN_FRAME=document.getElementById("login-frame"),Qt.LOBBY_FRAME=document.getElementById("lobby-frame"),Qt.ROOM_FRAME=document.getElementById("room-frame"),Qt.GAME_FRAME=document.getElementById("game-frame"),Y()}function Y(){for(var t=3,e=0;e<Yt.assetImageList.length;++e){var i=new Image;Yt.images[Yt.assetImageList[e]]=i,i.onload=function(e){return function(){Yt.loadedAssetCount++;var i=document.createElement("canvas");i.width=Yt.images[e].width,i.height=Yt.images[e].height;var s=i.getContext("2d");s.save(),s.drawImage(Yt.images[e],0,0,Yt.images[e].width,Yt.images[e].height,0,0,Yt.images[e].width,Yt.images[e].height);for(var a=s.getImageData(0,0,i.width,i.height),o=0;o<a.data.length;o+=4)a.data[o]-a.data[o+1]<=t&&a.data[o+1]-a.data[o+2]<=t&&(a.data[o]<100||a.data[o+3]<255)||(a.data[o]=Math.min(255,1.25*a.data[o]),a.data[o+1]=Math.min(255,.5*a.data[o+1]),a.data[o+2]=Math.min(255,.5*a.data[o+2]));s.putImageData(a,0,0),s.restore(),Yt.images[e+"/b"]=i,V()}}(Yt.assetImageList[e]),i.src=Yt.assetImageList[e]}}function V(){var t=document.getElementById("loading-caption");t.innerHTML=Math.floor(Yt.loadedAssetCount/(Yt.assetImageList.length+Yt.assetSoundList.length)*100)+"%",Yt.loadedAssetCount==Yt.assetImageList.length+Yt.assetSoundList.length&&K()}function K(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,Zt.mouseImg=Yt.images["asset/mouse.png"],Zt.mouseShadowImg=Yt.images["asset/mouse_shadow.png"],Zt.mouse[0]=Zt.canvas.width/2,Zt.mouse[1]=Zt.canvas.height/2,Nt(),et(),kt(),pt("LOGIN_FRAME")}function j(){qt.scheduler&&clearInterval(qt.scheduler),qt.gameEventHandlerResetFunction&&qt.gameEventHandlerResetFunction(),qt={},Qt.GAME_FRAME.style.setProperty("display","block"),X(Zt.currentRoom.chosenMap),qt.mapSplit=Zt.currentRoom.mapSplit,Zt.menuBar=new k,Zt.camera[0]=qt.thrones[Zt.team].pos.x-Zt.canvas.width/2,Zt.camera[1]=qt.thrones[Zt.team].pos.y-Zt.canvas.height/2,Zt.gameEventHandlerResetFunction=it(),Tt(),qt.snapshot.timestep=-1,qt.scheduler=setInterval(function(){return qt.timestep-qt.lastSynchronized>jt.ALLOWED_DELAY&&(Mt("Enemy is lagging"),qt.isLagging=!0),qt.isLagging&&qt.timestep-qt.lastSynchronized>jt.RECOVERED_DELAY?(ht(),q(),qt.hasFogOfWar&&xt(),Z(),qt.hasFogOfWar&&Ht(),lt(),void Q()):(qt.isLagging=!1,bt(),qt.isGameOver||(ht(),$()),q(),qt.hasFogOfWar&&xt(),Z(),qt.hasFogOfWar&&Ht(),lt(),Q(),void(qt.isGameOver||_t()))},jt.FPS)}function X(t){var e=Xt[t],i=e.width,s=e.height,a=e.asset,o={map:{width:i,height:s,data:new Int32Array(i*s).fill(1),entry:new Array(i*s).fill(null),imgBuffer:Yt.images[a],size:64,lastUpdated:0,specialEffect:e.specialEffect?e.specialEffect():null,fogOfWar:new Int32Array(i*s).fill(1)},deadflocks:[],deadarrows:[],deadbuildings:[],flocks:[],buildings:[],arrows:[],numbers:[],timestep:0,thrones:[],ranchTier:[1,1],towerTier:[1,1],coins:[10,10],lastSynchronized:-1,lastSent:0,localCommandLog:[],commandBackLog:[[],[]],declaredVictory:[!1,!1],isGameOver:!1,madeDeclaration:!1,isRedoing:!1,numberOfFlocks:[0,0],mapSplit:!0,hasFogOfWar:Zt.currentRoom?Zt.currentRoom.fogOfWar:!1,isLagging:!1};qt=o;for(var n=0;n<e.thrones.length;++n)o.thrones.push(new w(e.thrones[n][0],e.thrones[n][1],n))}function q(){var t=Zt.mouse,e=Zt.camera,i=10*jt.SCALER,s=4;t[0]<=s&&(e[0]-=i),t[0]>=canvas.width-s-32&&(e[0]+=i),t[1]<=s&&(e[1]-=i),t[1]>=canvas.height-s-32&&(e[1]+=i);var a=180,o=Math.max(0,(Zt.canvas.width-qt.map.height*qt.map.size)/2),n=Math.max(0,(Zt.canvas.width-qt.map.width*qt.map.size)/2);e[0]<-n&&(e[0]=-n),e[1]<-o&&(e[1]=-o),e[0]=Math.min(e[0],qt.map.size*qt.map.width+n-Zt.canvas.width),e[1]=Math.min(e[1],qt.map.size*qt.map.height+a+o-Zt.canvas.height)}function Z(){var t=Zt.g,e=Zt.camera,i=Zt.canvas,s=qt.map;if(t.clearRect(0,0,i.width,i.height),t.fillStyle="rgba(0,0,0,0.8)",t.fillRect(0,0,i.width,i.height),t.drawImage(s.imgBuffer,Math.max(0,e[0]),Math.max(0,e[1]),Math.min(i.width,e[0]+i.width),Math.min(i.height,e[1]+i.height),Math.max(0,-e[0]),Math.max(0,-e[1]),Math.min(i.width,e[0]+i.width),Math.min(i.height,e[1]+i.height)),t.save(),t.translate(-e[0],-e[1]),qt.mapSplit){t.save();var a=qt.map.height/2*qt.map.size;t.fillStyle="rgba(255,200,0,0.2)",t.fillRect(0,a-4,qt.map.size*qt.map.width,8),t.restore()}for(var o=[qt.thrones,qt.deadbuildings,qt.buildings,qt.deadflocks,qt.deadarrows,qt.flocks,qt.arrows,qt.numbers],n=0;n<o.length;++n)for(var r=0;r<o[n].length;++r)o[n][r].render(t);for(var h=[],n=0;n<qt.numbers.length;++n)qt.numbers[n].isAlive&&h.push(qt.numbers[n]);qt.numbers=h,qt.map.specialEffect&&qt.map.specialEffect(t),t.restore(),J(t)}function Q(){Zt.mouseTrapped||Mt("Click on the screen to move the piggi mouse.");var t=Zt.g;t.save(),t.translate(Zt.mouse[0],Zt.mouse[1]),t.save(),t.globalAlpha=.2,t.drawImage(Zt.mouseShadowImg,0,0,128,128,3,10,30,30),t.restore(),"DESTROY"==Zt.state?t.drawImage(Yt.images["asset/destroy.png"],0,0,128,128,0,0,32,32):t.drawImage(Zt.mouseImg,0,0,128,128,0,0,32,32),t.restore()}function J(t){if("BUILDING"==Zt.state){var e=ot(Zt.mouse[0]+Zt.camera[0],Zt.mouse[1]+Zt.camera[1]);t.save(),t.fillStyle=st(e[0],e[1],Zt.buildingSize,Zt.team)||!at(e[0],e[1],Zt.buildingSize)?"red":"green",t.globalAlpha=.5,t.fillRect(e[1]*qt.map.size-Zt.camera[0],e[0]*qt.map.size-Zt.camera[1],Zt.buildingSize*qt.map.size,Zt.buildingSize*qt.map.size),t.restore()}else if("DESTROY"==Zt.state){var e=ot(Zt.mouse[0]+Zt.camera[0],Zt.mouse[1]+Zt.camera[1]);t.save(),t.fillStyle=Bt(e[0],e[1],Zt.team)?"green":"red",t.globalAlpha=.5,t.fillRect(e[1]*qt.map.size-Zt.camera[0],e[0]*qt.map.size-Zt.camera[1],qt.map.size,qt.map.size),t.restore()}}function $(){if(qt.timestep%jt.BACKGROUND_MONEY_RATE==0)for(var t=0;t<qt.coins.length;++t)qt.coins[t]+=1;for(var e=[qt.deadbuildings,qt.deadflocks,qt.deadarrows,qt.flocks,qt.buildings,qt.arrows,qt.thrones],t=0;t<e.length;++t)for(var i=0;i<e[t].length;++i)e[t][i].update(qt.flocks,qt.map);tt();for(var t=0;t<qt.coins.length;++t)qt.coins[t]=Math.min(qt.coins[t],jt.MAX_COINS);if(qt.timestep!=qt.lastSynchronized||Zt.isSinglePlayer||Tt(),Zt.isSinglePlayer&&(qt.thrones[0].isAlive?qt.thrones[1].isAlive||(qt.declaredVictory[0]=!0):qt.declaredVictory[1]=!0,qt.declaredVictory[0]||qt.declaredVictory[1]))return void Ct();qt.timestep++;(Zt.team+1)%2;if(qt.snapshot&&(!qt.thrones[0].snapshot.isAlive||!qt.thrones[1].snapshot.isAlive)){for(var s=-1,t=0;t<qt.thrones.length;++t)qt.thrones[t].snapshot.isAlive||(-1==s?s=t:qt.thrones[s].snapshot.timeOfDeath>qt.thrones[t].snapshot.timeOfDeath&&(s=t));return qt.declaredVictory[s]=!0,qt.declaredVictory[(s+1)%2]=!1,void Ct()}}function tt(){for(var t=[],e=0;e<qt.deadflocks.length;++e)qt.deadflocks[e].garbageCollectible()?qt.deadflocks[e].cleanUp(qt.flocks,qt.map):t.push(qt.deadflocks[e]);qt.deadflocks=t,t=[];for(var e=0;e<qt.deadarrows.length;++e)qt.deadarrows[e].garbageCollectible()?qt.deadarrows[e].cleanUp(qt.flocks,qt.map):t.push(qt.deadarrows[e]);qt.deadarrows=t,t=[];for(var e=0;e<qt.deadbuildings.length;++e)qt.deadbuildings[e].garbageCollectible()?qt.deadbuildings[e].cleanUp(qt.flocks,qt.map):t.push(qt.deadbuildings[e]);qt.deadbuildings=t,t=[];for(var e=0;e<qt.flocks.length;++e)qt.flocks[e].isAlive?t.push(qt.flocks[e]):qt.deadflocks.push(qt.flocks[e]);qt.flocks=t,t=[];for(var e=0;e<qt.arrows.length;++e)qt.arrows[e].isAlive?t.push(qt.arrows[e]):qt.deadarrows.push(qt.arrows[e]);qt.arrows=t,t=[];for(var e=0;e<qt.buildings.length;++e)qt.buildings[e].isAlive?t.push(qt.buildings[e]):qt.deadbuildings.push(qt.buildings[e]);qt.buildings=t}function et(){function t(){return document.pointerLockElement===a||document.mozPointerLockElement===a||document.webkitPointerLockElement===a}function e(){t()?(bt(),document.addEventListener("mousemove",i,!1),Zt.mouse=[a.width/2,a.height/2],Zt.mouseTrapped=!0):(document.removeEventListener("mousemove",i,!1),Zt.mouseTrapped=!1)}function i(t){var e=Zt.mouse,i=(Zt.camera,t.movementX);movementY=t.movementY,e[0]=Math.min(Math.max(0,e[0]+1.2*i),a.width-32),e[1]=Math.min(Math.max(0,e[1]+1.2*movementY),a.height-32)}function s(e){t()||(a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock())}var a=(Zt.camera,Zt.canvas);qt.map;a.addEventListener("mousedown",s),document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1);var o=document.getElementById("login-input");o.addEventListener("keydown",function(t){if(13==t.which){var e=o.value;return Wt.emit("login-name",e),pt("LOBBY_FRAME"),!1}}),document.getElementById("create-room").addEventListener("click",function(){document.getElementById("create-room-form").style.display="block",document.getElementById("room-title").value="",document.getElementById("room-title").focus()}),document.getElementById("create-room-cancel").onclick=function(){document.getElementById("create-room-form").style.display="none"},document.getElementById("room-title").addEventListener("keydown",function(t){return 13==t.which?(dt(document.getElementById("room-title").value),document.getElementById("create-room-form").style.display="none",!1):void 0}),document.getElementById("create-room-submit").addEventListener("click",function(t){dt(document.getElementById("room-title").value),document.getElementById("create-room-form").style.display="none"}),document.getElementById("start-game-button").addEventListener("click",function(){if(Zt.isHost)if(Zt.currentRoom.isSinglePlayer)Ft();else{if(-1==Zt.currentRoom.guestId)return;Wt.emit("request-start-game"),It()}}),document.getElementById("exit-button").addEventListener("click",function(){Zt.isHost=!1,Wt.emit("exit-room"),pt("LOBBY_FRAME")}),document.getElementById("prev-map").addEventListener("click",function(){var t=Zt.currentRoom.chosenMap-1;0>t&&(t+=Xt.length),Zt.currentRoom.chosenMap=t,Zt.currentRoom.isSinglePlayer||Wt.emit("map-change",t),Lt()}),document.getElementById("next-map").addEventListener("click",function(){var t=(Zt.currentRoom.chosenMap+1)%Xt.length;Zt.currentRoom.chosenMap=t,Zt.currentRoom.isSinglePlayer||Wt.emit("map-change",t),Lt()}),document.getElementById("tutorial").addEventListener("click",function(){Ut()}),document.getElementById("single-player").addEventListener("click",function(){Zt.currentRoom={id:0,title:"Single Player",chosenMap:0,mapSplit:!0,fogOfWar:!0,isSinglePlayer:!0,hostId:Zt.id},Zt.isHost=!0,pt("ROOM_FRAME")}),document.getElementById("tutorial-ok-button").addEventListener("click",function(){zt()}),document.getElementById("map-split").addEventListener("change",function(){return Zt.isHost?(Zt.currentRoom.mapSplit=this.checked,Zt.currentRoom.isSinglePlayer||Wt.emit("map-split-change",this.checked),void Lt()):void Lt()}),document.getElementById("map-fog").addEventListener("change",function(){return Zt.isHost?(Zt.currentRoom.fogOfWar=this.checked,Zt.currentRoom.isSinglePlayer||Wt.emit("map-fog-change",this.checked),void Lt()):void Lt()}),Wt.on("id",function(t){Zt.id=t}),Wt.on("online",function(t){Zt.online.push(t.id),Zt.player[t.id]=t,ft(t)}),Wt.on("new-room",function(t){Zt.room[t.id]=t,Zt.roomList.push(t.id),mt(t)}),Wt.on("room-list",function(t){Zt.roomList=[],Zt.room={};for(var e=0;e<t.length;++e)Zt.roomList.push(t[e].id),Zt.room[t[e].id]=t[e];mt()}),Wt.on("online-player",function(t){Zt.online=[];for(var e=0;e<t.length;++e)Zt.online.push(t[e].id),Zt.player[t[e].id]=t[e];ft()}),Wt.on("offline",function(t){vt(t),ft()}),Wt.on("room-created",function(t){Zt.room[t.id]=t,Zt.roomList.push(t.id),Zt.currentRoom=t,Zt.isHost=!0,Zt.currentRoom.chosenMap=0,pt("ROOM_FRAME")}),Wt.on("room-full",function(t){Zt.room[t].full=!0,gt(Zt.room[t]),Zt.enteringRoomId==msg&&At("Room is currently full")}),Wt.on("room-available",function(t){Zt.room[t].full=!1,gt(Zt.room[t])}),Wt.on("room-exited",function(t){Zt.currentRoom&&Zt.currentRoom.guestId==t&&(Zt.currentRoom.guestId=-1,Lt())}),Wt.on("room-unavailable",function(t){Zt.enteringRoomId==t&&(At("Room is currently unavailable"),wt())}),Wt.on("room-joined",function(t){t.id==Zt.enteringRoomId&&(Zt.room[t.id]=t,Zt.currentRoom=t,Zt.currentRoom.guestId=Zt.id,Zt.playingWithId=Zt.currentRoom.hostId,pt("ROOM_FRAME"),wt())}),Wt.on("room-visitor",function(t){guestId=t.id,username=t.username,Zt.currentRoom&&(Zt.currentRoom.guestId=guestId,Zt.player[guestId]={username:username,id:guestId},Zt.playingWithId=guestId,Lt())}),Wt.on("map-change",function(t){Zt.currentRoom.chosenMap=t,Lt()}),Wt.on("map-split-change",function(t){Zt.currentRoom.mapSplit=t,Lt()}),Wt.on("map-fog-change",function(t){Zt.currentRoom.fogOfWar=t,Lt()}),Wt.on("room-deleted",function(t){for(var e=[],i=0;i<Zt.roomList.length;++i){var s=Zt.roomList[i];s!=t&&e.push(s)}Zt.roomList=e,delete Zt.room[t],mt()}),Wt.on("room-owner",function(t){Zt.currentRoom&&Zt.currentRoom.id==t&&(Zt.isHost=!0,Zt.currentRoom.guestId=-1,Zt.currentRoom.hostId=Zt.id,Lt())}),Wt.on("start-game",function(t){Zt.isHost?Zt.team=t.host:Zt.team=t.guest,Zt.isGameOngoing=!0,Zt.isSinglePlayer=!1,pt("GAME_FRAME"),wt(),j()}),Wt.on("commands",function(t){Zt.isGameOngoing&&Rt(t)})}function it(){function t(t){var e=Zt.mouse[0]+Zt.camera[0],i=Zt.mouse[1]+Zt.camera[1],s=Zt.mouse[0],a=Zt.mouse[1];if(1==t.buttons){if(Zt.menuBar.containsPoint(s,a))return void Zt.menuBar.onclick(s,a);if("BUILDING"==Zt.state){var o=ot(e,i);!st(o[0],o[1],Zt.buildingSize,Zt.team)&&at(o[0],o[1],Zt.buildingSize)&&(Zt.state="NONE",Zt.menuBar.reset(),nt(Zt.currentCommand,[o[0],o[1],Zt.team]))}else if("DESTROY"==Zt.state){var o=ot(e,i);Bt(o[0],o[1],Zt.team)&&(Zt.state="NONE",nt(Vt.DESTROY,[o[0],o[1],Zt.team]),Zt.menuBar.reset())}}else 2==t.buttons&&("BUILDING"==Zt.state||"DESTROY"==Zt.state)&&Zt.menuBar.deselect.onclick()}function e(t){Zt.mouse[0]+Zt.camera[0],Zt.mouse[1]+Zt.camera[1];84==t.which?Zt.menuBar.tower.onclick():65==t.which?Zt.menuBar.farm.onclick():70==t.which?Zt.menuBar.fence.onclick():82==t.which?Zt.menuBar.ranch.onclick():67==t.which?Zt.menuBar.castle.onclick():72==t.which?Zt.menuBar.pighq.onclick():71==t.which?Zt.menuBar.garden.onclick():87==t.which?Zt.menuBar.wall.onclick():85==t.which?Zt.menuBar.upgrade.onclick():68==t.which&&Zt.menuBar.deselect.onclick()}var i=(Zt.camera,Zt.canvas);qt.map;return i.addEventListener("mousedown",t),document.addEventListener("keydown",e),function(){document.removeEventListener("mousedown",t),document.removeEventListener("keydown",e)}}function st(t,e,i,s){if(qt.mapSplit){if(0==s&&t>=qt.map.height/2)return!0;if(1==s&&t<qt.map.height/2)return!0}for(var a=0;i>a;++a)for(var o=0;i>o;++o){if(0>t+a||0>e+o||t+a>=qt.map.height||e+o>=qt.map.width)return!0;if(qt.map.entry[(t+a)*qt.map.width+(e+o)])return!0}for(var a=0;a<qt.flocks.length;++a)for(var n=0;i>n;++n)for(var r=0;i>r;++r)if(qt.flocks[a].collidesWithCell(qt.map,[t+n,e+r]))return!0;return!1}function at(t,e,i){if(!qt.hasFogOfWar)return!0;for(var s=t;t+i>s;++s)for(var a=e;e+i>a;++a){if(0>s||0>a||s>=qt.map.height||a>=qt.map.width)return!1;var o=s*qt.map.width+a;if(0==qt.map.fogOfWar[o])return!1}return!0}function ot(t,e){return[Math.floor(e/qt.map.size),Math.floor(t/qt.map.size)]}function nt(t,e){qt.isLagging||(qt.localCommandLog.push([qt.timestep,t,e]),qt.commandBackLog[Zt.team].push([qt.timestep,t,e]))}function rt(t,e){var i=t[0],s=t[1],a=t[2];if(s==Vt.BUILD_TOWER){if(st(a[0],a[1],2,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_TOWER);qt.buildings.push(new u(a[0],a[1],a[2]))}else if(s==Vt.BUILD_FARM){if(st(a[0],a[1],1,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_FARM);qt.buildings.push(new f(a[0],a[1],a[2]))}else if(s==Vt.BUILD_FENCE){if(st(a[0],a[1],1,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_FENCE);qt.buildings.push(new v(a[0],a[1],a[2]))}else if(s==Vt.BUILD_PIG_RANCH){if(st(a[0],a[1],2,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_PIG_RANCH);qt.buildings.push(new A(a[0],a[1],a[2]))}else if(s==Vt.BUILD_CASTLE){if(st(a[0],a[1],2,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_CASTLE);qt.buildings.push(new g(a[0],a[1],a[2]))}else if(s==Vt.BUILD_GARDEN){if(st(a[0],a[1],1,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_GARDEN);qt.buildings.push(new y(a[0],a[1],a[2]))}else if(s==Vt.BUILD_WALL){if(st(a[0],a[1],1,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_WALL);qt.buildings.push(new E(a[0],a[1],a[2]))}else if(s==Vt.BUILD_PIG_HQ){if(st(a[0],a[1],2,a[2]))return void(qt.coins[a[2]]+=Kt.BUILD_PIG_HQ);qt.buildings.push(new I(a[0],a[1],a[2]))}else if(s==Vt.UPGRADE_PIG_RANCH){if(2==qt.ranchTier[a[0]])return;if(qt.coins[a[0]]<Kt.UPGRADE_PIG_RANCH)return;qt.coins[a[0]]-=Kt.UPGRADE_PIG_RANCH,qt.ranchTier[a[0]]=2}else if(s==Vt.UPGRADE_TOWER){if(2==qt.towerTier[a[0]])return;if(qt.coins[a[0]]<Kt.UPGRADE_TOWER)return;qt.coins[a[0]]-=Kt.UPGRADE_TOWER,qt.towerTier[a[0]]=2}else if(s==Vt.BUY){var o=a[0],n=a[1],r=a[2];qt.coins[o]>=r&&(qt.coins[o]-=r,ct(o)&&!e&&(Zt.currentCommand=n,Zt.state="BUILDING",Zt.buildingSize=a[3]))}else if(s==Vt.DESELECT)qt.coins[a[0]]+=a[1];else if(s==Vt.SYNCHRONIZED)qt.lastSynchronized=i;else if(s==Vt.VICTORY){var h=(a[0]+1)%2;if(qt.declaredVictory[0]||qt.declaredVictory[1])return;if(qt.thrones[h].isAlive)return void(qt.madeDeclaration=!1);qt.declaredVictory[a[0]]=!0}else if(s==Vt.DESTROY&&Bt(a[0],a[1],a[2])){var l=qt.map.entry[a[0]*qt.map.width+a[1]];l.receiveDamage(1e9)}}function ht(){if(!qt.isGameOver){qt.trueTime=qt.timestep;var t=(Zt.team+1)%2;if(qt.commandBackLog[t].length>0&&qt.commandBackLog[t][0][0]<qt.timestep){var e=qt.timestep;Ot(),qt.isRedoing=!0;var i=0,s=0,a=0,o=0,n=qt.commandBackLog;qt.timestep++;for(var i=0,s=0,r=qt.timestep;e>r;++r){for(;i<n[0].length&&n[0][i][0]==r;)rt(n[0][i],!0),++i;for(;s<n[1].length&&n[1][s][0]==r;)rt(n[1][s],!0),++s;$()}for(var h=0==t?i:s,l=Zt.team,c=0,p=h>0?n[t][h-1][0]:-1;c<n[l].length&&n[l][c][0]<=p;)c++;qt.commandBackLog[t]=qt.commandBackLog[t].splice(h),qt.commandBackLog[l]=qt.commandBackLog[l].splice(c),qt.isRedoing=!1}if(!qt.isLagging){for(var i=0,s=0,a=0,o=0,n=qt.commandBackLog;i<n[0].length;)n[0][i][0]==qt.timestep&&(rt(n[0][i]),a=i+1),++i;for(;s<n[1].length;)n[1][s][0]==qt.timestep&&(rt(n[1][s]),o=s+1),++s;if(n[t].length>0){for(var h=0==t?a:o,l=Zt.team,c=0,p=h>0?n[t][h-1][0]:-1;c<n[l].length&&n[l][c][0]<=p;)c++;qt.commandBackLog[t]=qt.commandBackLog[t].splice(h),qt.commandBackLog[l]=qt.commandBackLog[l].splice(c)}}}}function lt(){Zt.menuBar.render(Zt.g)}function ct(t){return Zt.team==t}function pt(t){Qt[Zt.appState].style.setProperty("display","none"),"GAME_FRAME"==Zt.appState&&Qt[Zt.appState].style.setProperty("z-index","0"),Qt[t].style.setProperty("display","block"),Zt.appState=t,"LOGIN_FRAME"==t?document.getElementById("login-input").focus():"LOBBY_FRAME"==t?(document.getElementById("create-room-form").style.display="none",Wt.emit("get-online-player"),
Wt.emit("get-room-list")):"ROOM_FRAME"==t?Lt():"GAME_FRAME"==t&&Qt[Zt.appState].style.setProperty("z-index","5")}function dt(t){Wt.emit("create-room",t)}function mt(t){if(t)document.getElementById("room-list").insertBefore(ut(t),document.getElementById("room-list").lastChild);else{document.getElementById("room-list").innerHTML="";for(var e=0;e<Zt.roomList.length;++e){var i=Zt.roomList[e],s=Zt.room[i];document.getElementById("room-list").appendChild(ut(s))}var a=document.createElement("div");a.setAttribute("class","clear-fix"),document.getElementById("room-list").appendChild(a)}}function ut(t){var e=document.createElement("div"),i="<div class='room-item-title'>["+t.id+"] ";return i+=t.title+"</div>",i+="<div class='room-item-owner'>Owner: ["+t.hostId+"] ",i+=t.hostname+"</div>",i+="<div class='room-item-status'>Status: "+(t.full?'<span class="full">Full</span>':'<span class="avail">Available</span>')+"</div>",e.innerHTML=i,e.onclick=function(){t.full&&At("Room is currently full."),Zt.enteringRoomId=t.id,Wt.emit("join-room",t.id),It()},e.setAttribute("class","room-item"),t.div=e,e}function gt(t){var e=t.div,i="<div class='room-item-title'>["+t.id+"] ";i+=t.title+"</div>",i+="<div class='room-item-owner'>Owner: ["+t.hostId+"] ",i+=t.hostname+"</div>",i+="<div class='room-item-status'>Status: "+(t.full?'<span class="full">Full</span>':'<span class="avail">Available</span>')+"</div>",e.innerHTML=i}function ft(t){if(t)document.getElementById("online-user-list").appendChild(yt(t));else{document.getElementById("online-user-list").innerHTML="";for(var e=0;e<Zt.online.length;++e){var i=Zt.online[e];document.getElementById("online-user-list").appendChild(yt(Zt.player[i]))}}}function yt(t){var e=document.createElement("div"),i="<div class='id'>"+t.id+"</div>";return i+="<div class='name'>"+t.username+"</div>",e.innerHTML=i,e.setAttribute("class","online-list-item"),t.div=e,e}function vt(t){for(var e=[],i=0;i<Zt.online.length;++i)Zt.online[i]!=t&&e.push(Zt.online[i]);Zt.online=e,Zt.playingWithId==t&&Et(),delete Zt.player[t]}function Et(){qt.declaredVictory[Zt.team]=!0,Ct()}function At(t){}function It(){document.getElementById("waiting-screen").style.display="block"}function wt(){document.getElementById("waiting-screen").style.display="none"}function Lt(){document.getElementById("room-frame-title").innerHTML="Room Title : ["+Zt.currentRoom.id+"] "+Zt.currentRoom.title,document.getElementById("start-game-button").style.display=Zt.isHost?"block":"none",document.getElementById("map-options").style.display=Zt.isHost?"block":"none",document.getElementById("map-split").checked=Zt.currentRoom.mapSplit,document.getElementById("map-fog").checked=Zt.currentRoom.fogOfWar,Zt.currentRoom.isSinglePlayer?(document.getElementById("room-frame-guest").innerHTML="Simple Piggi AI",document.getElementById("guest-title").style.setProperty("background-color","rgba(133,255,133,0.5)"),document.getElementById("start-game-button").style.setProperty("opacity","1.0")):(document.getElementById("room-frame-guest").innerHTML=-1==Zt.currentRoom.guestId?"Waiting.":"["+Zt.currentRoom.guestId+"] "+Zt.player[Zt.currentRoom.guestId].username,-1==Zt.currentRoom.guestId?(document.getElementById("guest-title").style.setProperty("background-color","rgba(255,100,100,0.5)"),document.getElementById("start-game-button").style.setProperty("opacity","0.5")):(document.getElementById("guest-title").style.setProperty("background-color","rgba(133,255,133,0.5)"),document.getElementById("start-game-button").style.setProperty("opacity","1.0"))),document.getElementById("room-frame-host").innerHTML="["+Zt.currentRoom.hostId+"] "+Zt.player[Zt.currentRoom.hostId].username;var t=document.getElementById("map-info-canvas"),e=t.getContext("2d"),i=Xt[Zt.currentRoom.chosenMap];e.drawImage(Yt.images[i.asset],0,0,Yt.images[i.asset].width,Yt.images[i.asset].width,0,0,t.width,t.height),document.getElementById("map-title").innerHTML="Location : "+i.title,document.getElementById("map-dimension").innerHTML="Size : "+i.width+" x "+i.height}function _t(t){Zt.isSinglePlayer||!t&&qt.timestep-qt.lastSent<=jt.SEND_DELAY||(qt.lastSent=qt.timestep,qt.localCommandLog.push([t?qt.trueTime:qt.timestep-1,Vt.SYNCHRONIZED,[]]),Wt.emit("commands",qt.localCommandLog),qt.localCommandLog=[])}function Tt(){for(var t={map:{data:new Int32Array(qt.map.width*qt.map.height).fill(1),entry:new Array(qt.map.width*qt.map.height).fill(null),lastUpdated:0},deadflocks:[],deadarrows:[],deadbuildings:[],flocks:[],buildings:[],arrows:[],timestep:0,thrones:[],ranchTier:[1,1],towerTier:[1,1],coins:[10,10],declaredVictory:[!1,!1],madeDeclaration:!1,numberOfFlocks:[0,0]},e=0;e<qt.map.width*qt.map.height;++e)t.map.data[e]=qt.map.data[e];for(var e=0;e<qt.map.width*qt.map.height;++e)t.map.entry[e]=qt.map.entry[e];t.map.lastUpdated=qt.map.lastUpdated;for(var e=0;e<qt.deadflocks.length;++e)t.deadflocks.push(qt.deadflocks[e]),qt.deadflocks[e].createSnapshot();for(var e=0;e<qt.deadbuildings.length;++e)t.deadbuildings.push(qt.deadbuildings[e]),qt.deadbuildings[e].createSnapshot();for(var e=0;e<qt.deadarrows.length;++e)t.deadarrows.push(qt.deadarrows[e]),qt.deadarrows[e].createSnapshot();t.timestep=qt.timestep;for(var e=0;e<qt.flocks.length;++e)t.flocks.push(qt.flocks[e]),qt.flocks[e].createSnapshot();for(var e=0;e<qt.buildings.length;++e)t.buildings.push(qt.buildings[e]),qt.buildings[e].createSnapshot();for(var e=0;e<qt.arrows.length;++e)t.arrows.push(qt.arrows[e]),qt.arrows[e].createSnapshot();for(var e=0;e<qt.thrones.length;++e)t.thrones.push(qt.thrones[e]),qt.thrones[e].createSnapshot();for(var e=0;e<qt.ranchTier.length;++e)t.ranchTier[e]=qt.ranchTier[e],t.towerTier[e]=qt.towerTier[e],t.coins[e]=qt.coins[e],t.declaredVictory[e]=qt.declaredVictory[e],t.numberOfFlocks[e]=qt.numberOfFlocks[e];t.madeDeclaration=qt.madeDeclaration,qt.snapshot=t}function Ot(){snapshot=qt.snapshot;for(var t=0;t<qt.map.width*qt.map.height;++t)qt.map.data[t]=snapshot.map.data[t];for(var t=0;t<qt.map.width*qt.map.height;++t)qt.map.entry[t]=snapshot.map.entry[t];qt.map.lastUpdated=snapshot.map.lastUpdated,qt.deadflocks=snapshot.deadflocks;for(var t=0;t<qt.deadflocks.length;++t)qt.deadflocks[t].rollback();qt.flocks=snapshot.flocks;for(var t=0;t<qt.flocks.length;++t)qt.flocks[t].rollback();qt.deadbuildings=snapshot.deadbuildings;for(var t=0;t<qt.deadbuildings.length;++t)qt.deadbuildings[t].rollback();qt.buildings=snapshot.buildings;for(var t=0;t<qt.buildings.length;++t)qt.buildings[t].rollback();qt.deadarrows=snapshot.deadarrows;for(var t=0;t<qt.deadarrows.length;++t)qt.deadarrows[t].rollback();qt.arrows=snapshot.arrows;for(var t=0;t<qt.arrows.length;++t)qt.arrows[t].rollback();qt.timestep=snapshot.timestep,qt.thrones=snapshot.thrones;for(var t=0;t<qt.thrones.length;++t)qt.thrones[t].rollback();for(var t=0;t<qt.ranchTier.length;++t)qt.ranchTier[t]=snapshot.ranchTier[t],qt.towerTier[t]=snapshot.towerTier[t],qt.coins[t]=snapshot.coins[t],qt.declaredVictory[t]=snapshot.declaredVictory[t],qt.numberOfFlocks[t]=snapshot.numberOfFlocks[t];qt.madeDeclaration=snapshot.madeDeclaration}function Rt(t){var e=(Zt.team+1)%2;qt.commandBackLog[e]=qt.commandBackLog[e].concat(t)}function kt(){Qt.GAME_FRAME.style.setProperty("display","block"),X(0),qt.flocks.push(new d(new t(canvas.width/2,canvas.height/2),0));var e=-1e4,i=1e3;qt.thrones[1].isAlive=!1,qt.hasFogOfWar=!1,qt.mapSplit=!1,qt.scheduler=setInterval(function(){qt.timestep-e>i&&(qt.flocks[0].setLockOnTarget({isAlive:!0,MOVING_TARGET:!0,pos:new t(Math.random()*qt.map.width*qt.map.size,Math.random()*qt.map.height*qt.map.size)},qt.map),e=qt.timestep),$(),Zt.camera[0]=qt.flocks[0].pos.x-Zt.canvas.width/2,Zt.camera[1]=qt.flocks[0].pos.y-Zt.canvas.height/2,q(),Z()},jt.FPS)}function Ct(){Zt.isGameOngoing&&(_t(!0),qt.isGameOver=!0,Zt.isGameOngoing=!1,Dt())}function St(){Zt.team=0,Zt.state="NONE",Zt.isSinglePlayer=!1,qt.scheduler&&clearInterval(qt.scheduler),qt.gameEventHandlerResetFunction&&qt.gameEventHandlerResetFunction(),bt()}function Dt(){function t(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),St(),document.removeEventListener("click",t),document.removeEventListener("keydown",e),document.getElementById("game-over-notice").style.display="none",pt("ROOM_FRAME"),kt()}function e(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),St(),document.removeEventListener("click",t),document.removeEventListener("keydown",e),document.getElementById("game-over-notice").style.display="none",pt("ROOM_FRAME"),kt()}qt.declaredVictory[Zt.team]?document.getElementById("notice-text1").innerHTML="You Win!":document.getElementById("notice-text1").innerHTML="You Lose.",Zt.mouseTrapped?document.getElementById("notice-text2").innerHTML="Press any key to exit.":document.getElementById("notice-text2").innerHTML="Click here to exit.",document.addEventListener("click",t),document.addEventListener("keydown",e),document.getElementById("game-over-notice").style.display="block"}function Mt(t){document.getElementById("game-notice-box").innerHTML=t,document.getElementById("game-notice-box").style.display="block"}function bt(){document.getElementById("game-notice-box").style.display="none"}function Bt(t,e,i){var s=qt.map.entry[t*qt.map.width+e];return s&&s.team==i&&s.destroyable}function Nt(){Xt.push({title:"Pigidow",asset:"asset/pigidow.jpg",width:20,height:32,thrones:[[0,0],[30,18]],specialEffect:null}),Xt.push({title:"Snowy Yosemite",asset:"asset/snowy-yosemite.jpg",width:25,height:40,thrones:[[0,12],[38,13]],specialEffect:Pt}),Xt.push({title:"Furpig Valley",asset:"asset/furpig-valley.jpg",width:4,height:20,thrones:[[0,1],[18,1]],specialEffect:null})}function Pt(){var e=[],i=300;return function(s){if(Math.random()<.4){var a=Math.random()*qt.map.width*qt.map.size,o=Math.random()*qt.map.height*qt.map.size;e.push({pos:new t(a,o),delta:0})}for(var n=[],r=0;r<e.length;++r)if(!(e[r].delta>=i)){if(n.push(e[r]),e[r].delta%20==0){var h=(Math.random()<.5?-1:1)*Math.random(),l=Math.random(),c=new t(h,l).normalize().times(.8);e[r].v=c}e[r].pos=e[r].pos.plus(e[r].v),s.drawImage(Yt.images["asset/snow.png"],0,0,128,128,e[r].pos.x,e[r].pos.y,32,32),e[r].delta++}e=n}}function Ut(){document.getElementById("tutorial-div").style.display="block"}function zt(){document.getElementById("tutorial-div").style.display="none"}function Ft(){pt("GAME_FRAME"),qt.scheduler&&clearInterval(qt.scheduler),qt.gameEventHandlerResetFunction&&qt.gameEventHandlerResetFunction(),qt={},Qt.GAME_FRAME.style.setProperty("display","block"),Zt.isGameOngoing=!0,Zt.isSinglePlayer=!0,X(Zt.currentRoom.chosenMap),qt.mapSplit=Zt.currentRoom.mapSplit,Zt.menuBar=new k,Zt.team=0,Zt.camera[0]=qt.thrones[Zt.team].pos.x-Zt.canvas.width/2,Zt.camera[1]=qt.thrones[Zt.team].pos.y-Zt.canvas.height/2,Zt.gameEventHandlerResetFunction=it(),Tt(),qt.snapshot.timestep=-1,qt.AI={},qt.AI.farms=0,qt.AI.fences=0,qt.AI.ranches=0,qt.AI.towers=0,qt.scheduler=setInterval(function(){qt.isGameOver||(Gt(),ht(),$()),q(),qt.hasFogOfWar&&xt(),Z(),qt.hasFogOfWar&&Ht(),lt(),Q(),qt.isGameOver||_t()},jt.FPS)}function Gt(){var t=(qt.thrones[1].row,!1);if(!(qt.timestep%30))for(var e=qt.map.height;e>=0;--e){for(var i=0;i<qt.map.width;i++){if(!st(e-1,i,2,1)){if(t=!0,Math.random()<.9)if(Math.random()<.9){if(qt.coins[1]>Kt.BUILD_PIG_RANCH){qt.AI.ranches++,qt.coins[1]-=Kt.BUILD_PIG_RANCH,nt(Vt.BUILD_PIG_RANCH,[e-1,i,1]);break}}else if(qt.coins[1]>Kt.BUILD_TOWER){qt.AI.towers++,qt.coins[1]-=Kt.BUILD_TOWER,nt(Vt.BUILD_TOWER,[e-1,i,1]);break}if((qt.AI.farms+qt.AI.fences)/(qt.AI.ranches+qt.AI.towers+1)>10)break}if(!st(e,i,1,1)&&(t=!0,Math.random()<.8))if(Math.random()<.7){if(qt.AI.farms<200&&qt.coins[1]>Kt.BUILD_FARM){qt.AI.farms++,qt.coins[1]-=Kt.BUILD_FARM,nt(Vt.BUILD_FARM,[e,i,1]);break}}else if(Math.random()<.001&&qt.coins[1]>Kt.BUILD_FENCE){qt.AI.fences++,qt.coins[1]-=Kt.BUILD_FENCE,nt(Vt.BUILD_FENCE,[e,i,1]);break}if(t)break}if(t)break}}function xt(){function t(t,e){for(var i=t-4;t+4>=i;++i)for(var s=e-4;e+4>=s;++s)if(!(0>i||0>s||i>=qt.map.height||s>=qt.map.width)){var a=Math.abs(i-t)+Math.abs(s-e);if(!(a>6)){var o=i*qt.map.width+s;qt.map.fogOfWar[o]=4>=a?jt.CLOSE_BY:0==qt.map.fogOfWar[o]?jt.FAR_AWAY:qt.map.fogOfWar[o]}}}qt.map.fogOfWar.fill(0);for(var e=0;e<qt.flocks.length;++e)if(qt.flocks[e].team==Zt.team){var i=Math.floor(qt.flocks[e].pos.y/qt.map.size),s=Math.floor(qt.flocks[e].pos.x/qt.map.size);t(i,s)}for(var e=0;e<qt.deadflocks.length;++e)if(qt.deadflocks[e].team==Zt.team){var i=Math.floor(qt.deadflocks[e].pos.y/qt.map.size),s=Math.floor(qt.deadflocks[e].pos.x/qt.map.size);t(i,s)}for(var e=0;e<qt.buildings.length;++e)if(qt.buildings[e].team==Zt.team)for(var a=qt.buildings[e].size/qt.map.size,i=qt.buildings[e].row;i<qt.buildings[e].row+a;++i)for(var s=qt.buildings[e].col;s<qt.buildings[e].col+a;++s)t(i,s);for(var e=0;e<qt.deadbuildings.length;++e)if(qt.deadbuildings[e].team==Zt.team)for(var a=qt.deadbuildings[e].size/qt.map.size,i=qt.deadbuildings[e].row;i<qt.deadbuildings[e].row+a;++i)for(var s=qt.deadbuildings[e].col;s<qt.deadbuildings[e].col+a;++s)t(i,s);for(var o=qt.thrones[Zt.team],a=o.size/qt.map.size,i=o.row;i<o.row+a;++i)for(var s=o.col;s<o.col+a;++s)t(i,s)}function Ht(){var t=Zt.g,e=Math.max(0,Math.floor(Zt.camera[1]/qt.map.size)),i=Math.max(0,Math.floor(Zt.camera[0]/qt.map.size)),s=Math.floor(Zt.canvas.width/qt.map.size)+1,a=Math.floor(Zt.canvas.height/qt.map.size)+1;t.save(),t.translate(-Zt.camera[0],-Zt.camera[1]);for(var o=e;e+a>=o;++o)for(var n=i;i+s>=n;++n)if(!(0>o||0>n||o>=qt.map.height||n>=qt.map.width)){var r=o*qt.map.width+n;if(qt.map.fogOfWar[r]!=jt.CLOSE_BY){var h=n*qt.map.size,l=o*qt.map.size;0==qt.map.fogOfWar[r]?t.fillStyle="rgba(0,0,0,0.6)":t.fillStyle="rgba(0,0,0,0.4)",t.fillRect(h,l,qt.map.size,qt.map.size)}}t.restore()}t.prototype.minus=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.normalize=function(){var t=this.length();return 0==t?this:(this.x/=t,this.y/=t,this)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.rotate=function(t){t=Math.PI/180*t;var e=this.x,i=this.y,s=Math.cos(t),a=Math.sin(t);return this.x=e*s-i*a,this.y=e*a+i*s,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.copy=function(){return new t(this.x,this.y)},t.prototype.flip=function(){return new t(-this.x,-this.y)},t.prototype.plus=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.times=function(e){return new t(this.x*e,this.y*e)},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.resize=function(t){var e=this.length();return this.x*=t/e,this.y*=t/e,this},s.prototype.push=function(t){if(null==this.root)this.root=new a(t);else{var e=Math.floor((this.size+1)/2),i=new a(t),s=this.atIndex(e);2*e==this.size+1?s.setLeft(i):s.setRight(i),this.heapUp(i)}this.size++},s.prototype.top=function(){return 0==this.size?null:this.root.value},s.prototype.pop=function(){var t=this.atIndex(this.size);this.size>1?(this.root.value=t.value,t.parent.left==t?t.parent.left=null:t.parent.right=null,t.parent=null,this.heapDown(this.root)):this.root=null,this.size--},s.prototype.atIndex=function(t){if(t>this.size)return null;for(var e=[],i=t;i>1;){var s=Math.floor(i/2);2*s==i?e.push("L"):e.push("R"),i=Math.floor(i/2)}for(var a=this.root,o=e.length-1;o>=0;--o)a="L"==e[o]?a.left:a.right;return a},s.prototype.heapUp=function(t){for(;t.parent&&!this.lessThan(t.parent.value,t.value);){var e=t.value;t.value=t.parent.value,t.parent.value=e,t=t.parent}},s.prototype.heapDown=function(t){for(;;){var e=null;if(t.left&&!this.lessThan(t.value,t.left.value)&&(e=t.left),t.right&&!this.lessThan(t.value,t.right.value)&&(!e||this.lessThan(t.right.value,e.value))&&(e=t.right),!e)return;var i=e.value;e.value=t.value,t.value=i,t=e}},a.prototype.setLeft=function(t){this.left=t,t.parent=this},a.prototype.setRight=function(t){this.right=t,t.parent=this},o.prototype.push=function(t){this.stackIn.push(t)},o.prototype.pop=function(){if(this.stackOut.length+this.stackIn.length==0)return null;if(0==this.stackOut.length)for(;this.stackIn.length>0;)this.stackOut.push(this.stackIn.pop());return this.stackOut.pop()},o.prototype.empty=function(){return this.stackIn.length+this.stackOut.length==0};h.prototype.render=function(t,e,i){var s=this.offsetX+this.currentFrame*this.width;t.drawImage(this.imgBuffer,s,this.offsetY,this.width,this.height,0,0,e,i)},h.prototype.update=function(){this.delta>=this.DELTA_PER_FRAME&&(this.delta=0,this.currentFrame++,this.autoReset?this.currentFrame%=this.numOfFrames:this.currentFrame=Math.min(this.currentFrame,this.numOfFrames-1)),this.delta++},h.prototype.reset=function(){this.delta=0,this.currentFrame=0},h.prototype.createSnapshot=function(){this.snapshot={delta:this.delta,currentFrame:this.currentFrame}},h.prototype.rollback=function(){this.delta=this.snapshot.delta,this.currentFrame=this.snapshot.currentFrame},l.prototype.seek=function(){var t=this.steeringEffect;if(null!=this.target){var e=i(this.target.minus(this.pos),this.MAXIMUM_SPEED),s=e.minus(this.velocity).times(t);this.force=this.force.plus(s)}},l.prototype.integrate=function(t){var s=this.force.times(this.invMass);s=i(s,this.AVOIDANCE_SPEED),this.velocity=this.velocity.plus(s),this.velocity=i(this.velocity,this.MAXIMUM_SPEED),this.pos=this.pos.plus(this.velocity);var a=this.steeringForce.times(this.invMass);a=i(a,this.AVOIDANCE_SPEED),this.pos=this.pos.plus(a),this.pos.x=Math.max(0,Math.min(this.pos.x,t.width*t.size-this.radius)),this.pos.y=Math.max(0,Math.min(this.pos.y,t.height*t.size-this.radius)),null!=this.target&&(this.orientation=e(this.velocity)),null==this.target&&0==this.targetStack.length&&null==this.lockOnTarget?this.velocity=this.velocity.times(.95):this.target&&this.target.minus(this.pos).length()<this.TARGET_RADIUS&&(this.target=this.targetStack.pop()),this.lockOnTarget&&this.lockOnTarget.pos.minus(this.pos).length()<.8*this.TARGET_RADIUS&&0==this.targetStack.length&&(this.velocity=this.velocity.times(.5)),this.force.x=this.force.y=0,this.steeringForce.x=this.steeringForce.y=0},l.prototype.setPath=function(t){this.targetStack=t,this.target=t.pop()},l.prototype.getInteractionType=function(t){t.setState(t.ATTACKING)},l.prototype.update=function(e,i){if(this.updateCount++,this.isAlive){var s=0!=this.integrateOnlyCounter;this.integrateOnlyCounter--,0==this.integrateOnlyCounter&&(this.integrateOnlyCounter=this.INTEGRATE_ONLY_MAX_COUNTER);var a=1,o=.04,n=1,r=60,h=1/30;this.checkSurrounding(e,i),this.seek();var l=this.pos.plus(this.velocity.times(h));if(!s){for(var c=0;c<e.length;++c)if(this!=e[c]){var p=this.pos.minus(e[c].pos);if(p.length()<r){var d=l.minus(e[c].pos).normalize();0==d.length()&&(d=new t(1,c),d.normalize());var m=d.times(this.AVOIDANCE_SPEED*a);this.steeringForce=this.steeringForce.plus(m)}}for(var u=-1,g=1e9,c=0;c<e.length;++c)if(this!=e[c]){var f=e[c].pos.plus(e[c].velocity.times(h)),y=l.minus(f).length();g>y&&(u=c,g=y)}if(-1!=u&&g<=e[u].radius){var v=l.minus(e[u].pos.plus(e[u].velocity.times(h)));v=v.normalize().times(this.AVOIDANCE_SPEED*n),this.force=this.force.plus(v)}}if(i){u=-1,g=1e9;var E=[Math.floor(l.y/i.size),Math.floor(l.x/i.size)],A=E[0]*i.width+E[1];if(A>0&&A<i.data.length&&0==i.data[A]){var v=l.minus(new t(i.size*(E[1]+.5),i.size*(E[0]+.5)));v=v.normalize().times(this.AVOIDANCE_SPEED),this.force=this.force.plus(v)}}if(this.integrate(i),s){for(var I=0,w=0,c=0;c<e.length;++c){var p=this.pos.minus(e[c].pos);p.length()<r&&(I+=e[c].orientation,w++)}w>0&&(I/=w,this.orientation=(1-o)*this.orientation+o*I)}if(i)for(var E=[Math.floor(this.pos.y/i.size),Math.floor(this.pos.x/i.size)],L=-1;1>=L;++L)for(var _=-1;1>=_;++_)this.resolveCollisionWithMap(i,[E[0]+L,E[1]+_]);this.handleLockOnTarget(e,i)}},l.prototype.checkSurrounding=function(e,i){function s(t,e){var i=e[0]*t.width+e[1];return i}function a(t,e){if(!(0>t||0>e||t>=i.height||e>=i.width)){var a=s(i,[t,e]);1!=d[a]&&(d[a]=1,p.push([t,e]))}}if(!(this.updateCount-this.lastEnvironmentCheck<=this.ENVIRONMENT_CHECK_DELAY)){this.lastEnvironmentCheck=this.updateCount,this.lockOnTarget&&this.setLockOnTarget(this.lockOnTarget,i);for(var n=1e9,r=-1,h=0;h<e.length;++h)if(e[h].isAlive&&e[h].team!=this.team){var l=e[h].pos.minus(this.pos).length();if(l>this.FLOCK_AGGRESIVENESS)continue;n>l&&(n=l,r=h)}if(-1!=r){var c=this.setLockOnTarget(e[r],i);if(c)return}var p=new o,d=new Int32Array(i.width*i.height).fill(0),m=[Math.floor(this.pos.y/i.size),Math.floor(this.pos.x/i.size)];for(p.push(m),d[s(i,m)]=1;!p.empty();){var u=p.pop(),g=s(i,u),f=new t((u[1]+.5)*i.size,(u[0]+.5)*i.size);if(!(this.pos.minus(f).length()>=this.BUILDING_AGGRESIVENESS)){if(i.entry[g]){var y=i.entry[g];if(y.canInteract(this)){var c=this.setLockOnTarget(y,i);if(c)break}}a(u[0]-1,u[1]),a(u[0]+1,u[1]),a(u[0],u[1]+1),a(u[0],u[1]-1)}}}},l.prototype.handleLockOnTarget=function(t,i){if(this.lockOnTarget){if(!this.lockOnTarget.isAlive)return this.lockOnTarget=null,this.state=this.STANDBY,this.target=null,this.targetStack=[],void(this.provoked=!1);var s=this.lockOnTarget.pos.minus(this.pos).length();s<=this.radius+this.lockOnTarget.radius+this.attackRadius?(this.targetStack=[],this.target=this.lockOnTarget.pos,this.lockOnTarget.MOVING_TARGET&&(this.target=null),this.lockOnTarget.getInteractionType(this),this.state==this.ATTACKING&&(this.updateCount-this.lastAttack>this.ATTACK_DELAY?(this.lastAttack=this.updateCount+this.sprites[this.ATTACKING].DELTA_PER_FRAME*this.sprites[this.ATTACKING].numOfFrames,this.sprites[this.ATTACKING].reset()):this.updateCount-this.lastAttack==-2*this.sprites[this.ATTACKING].DELTA_PER_FRAME&&(this.lockOnTarget.receiveDamage(this.strength),this.velocity=this.velocity.times(0))),this.state==this.EATING&&this.updateCount-this.lastAttack>this.ATTACK_DELAY&&(this.lockOnTarget.receiveDamage(this.strength),this.lastAttack=this.updateCount,this.velocity=this.velocity.times(0))):this.target||(s<2*i.size?this.target=this.lockOnTarget.pos:this.setLockOnTarget(this.lockOnTarget,i,!0)),(this.state==this.ATTACKING||this.state==this.EATING)&&(this.orientation=e(this.lockOnTarget.pos.minus(this.pos).normalize()))}},l.prototype.setLockOnTarget=function(t,e,i){if(!t.isAlive)return!1;if(t==this.lockOnTarget&&!i&&e.lastUpdated==this.pathTimestamp)return!0;if(null!=this.lockOnTarget&&this.lockOnTarget.interactionCount--,this.provoked=!0,this.lockOnTarget=t,t.interactionCount++,t.pos.minus(this.pos)<=e.size)return this.targetStack=[],this.target=t.pos,!0;var s=[Math.floor(this.pos.y/e.size),Math.floor(this.pos.x/e.size)],a=Math.floor(t.pos.y/e.size),o=Math.floor(t.pos.x/e.size),h=[];if(!t.MOVING_TARGET){var l=Math.floor(t.size/e.size);if(a=t.row+Math.floor(l/2),o=t.col+Math.floor(l/2),t.row-1>=0)for(var c=0;l>c;++c)h.push([t.row-1,t.col+c]);if(t.col-1>=0)for(var c=0;l>c;++c)h.push([t.row+c,t.col-1]);if(t.row+l<e.height)for(var c=0;l>c;++c)h.push([t.row+l,t.col+c]);if(t.col+l<e.width)for(var c=0;l>c;++c)h.push([t.row+c,t.col+l])}var p=n(s,[a,o],e,h),d=r(p,e);d[d.length-1]=this.pos,this.setPath(d);var m=p.length>0&&Math.abs(a-p[0][0])+Math.abs(o-p[0][1])<=1;if(!t.MOVING_TARGET&&p.length)for(var l=Math.floor(t.size/e.size),c=0;c<h.length;++c)if(Math.abs(h[c][0]-p[0][0])+Math.abs(h[c][1]-p[0][1])<=1){m=!0;break}return this.pathTimestamp=e.lastUpdated,m},l.prototype.setState=function(t){this.state=t},l.prototype.receiveDamage=function(t){this.isAlive&&(this.provoked=!0,this.healthPoints-=t,this.healthPoints<=0&&(this.healthPoints=0,this.isAlive=!1,this.state=this.DEAD,this.timeOfDeath=this.updateCount,this.lockOnTarget&&(this.lockOnTarget.interactionCount--,this.lockOnTarget=null)))},l.prototype.cleanUp=function(t,e){},l.prototype.garbageCollectible=function(){return!this.isAlive&&this.updateCount-this.timeOfDeath>=this.PERSISTENCE},l.prototype.resolveCollisionWithMap=function(e,i){var s=.1;if(this.collidesWithCell(e,i)){var a=i[0]*e.width+i[1];if(a>0&&a<e.data.length&&0==e.data[a]){var o=this.pos.minus(new t((i[1]+.5)*e.size,(i[0]+.5)*e.size)),n=e.size-Math.abs(o.x),r=new t(Math.sign(o.x),0);Math.abs(o.y)>Math.abs(o.x)&&(n=e.size-Math.abs(o.y),r.x=0,r.y=Math.sign(o.y)),this.pos=this.pos.plus(r.times(n*s))}}},l.prototype.collidesWithCell=function(t,e){return!(e[0]<0||e[1]<0||e[0]>=t.height||e[1]>=t.width||e[1]*t.size>this.pos.x+this.radius||(e[1]+1)*t.size<this.pos.x-this.radius||e[0]*t.size>this.pos.y+this.radius||(e[0]+1)*t.size<this.pos.y-this.radius)},l.prototype.drawTest=function(t){t.save(),t.rotate(Math.PI/2),t.scale(1,-1),t.fillStyle="black",t.beginPath(),t.moveTo(0,this.radius),t.lineTo(this.radius/2,-this.radius/2*Math.sqrt(3)),t.lineTo(-this.radius/2,-this.radius/2*Math.sqrt(3)),t.closePath(),t.fill(),t.restore()},c.prototype=Object.create(l.prototype),c.prototype.setSprite=function(t,e){this.sprites[t]=e},c.prototype.update=function(t,e){l.prototype.update.call(this,t,e),this.sprites[this.state].update()},c.prototype.render=function(t){if(t.save(),!this.isAlive){var e=1-Math.max(0,(this.updateCount-this.timeOfDeath)/this.PERSISTENCE);e=.5>e?.5:1,t.globalAlpha=e}t.translate(Math.floor(this.pos.x),Math.floor(this.pos.y)),t.rotate(Math.floor((this.orientation+90)/180*Math.PI*10)/10),t.translate(-this.radius,-this.radius),this.sprites[this.state].render(t,2*this.radius,2*this.radius),t.restore()},c.prototype.integrate=function(t){l.prototype.integrate.call(this,t),null==this.target&&this.state!=this.ATTACKING&&this.state!=this.EATING&&(this.state=this.STANDBY)},c.prototype.setPath=function(t){l.prototype.setPath.call(this,t),this.state==this.STANDBY?this.state=this.MOVING:null!=this.targetStack[0]&&this.pos.minus(this.targetStack[0]).length()>=4*this.radius&&(this.state=this.MOVING)},c.prototype.createSnapshot=function(){this.snapshot={pos:this.pos.copy(),force:this.force.copy(),steeringForce:this.steeringForce.copy(),velocity:this.velocity.copy(),orientation:this.orientation,target:this.target,targetStack:this.targetStack.slice(),pathTimestamp:this.pathTimestamp,state:this.state,lastEnvironmentCheck:this.lastEnvironmentCheck,updateCount:this.updateCount,lockOnTarget:this.lockOnTarget,lastAttack:this.lastAttack,healthPoints:this.healthPoints,isAlive:this.isAlive,provoked:this.provoked,timeOfDeath:this.timeOfDeath,integrateOnlyCounter:this.integrateOnlyCounter},this.sprites[this.state].createSnapshot()},c.prototype.rollback=function(){this.pos=this.snapshot.pos.copy(),this.force=this.snapshot.force.copy(),this.steeringForce=this.snapshot.steeringForce.copy(),this.velocity=this.snapshot.velocity.copy(),this.orientation=this.snapshot.orientation,this.target=this.snapshot.target,this.targetStack=this.snapshot.targetStack,this.pathTimestamp=this.snapshot.pathTimestamp,this.state=this.snapshot.state,this.lastEnvironmentCheck=this.snapshot.lastEnvironmentCheck,this.updateCount=this.snapshot.updateCount,this.lockOnTarget=this.snapshot.lockOnTarget,this.lastAttack=this.snapshot.lastAttack,this.healthPoints=this.snapshot.healthPoints,this.isAlive=this.snapshot.isAlive,this.provoked=this.snapshot.provoked,this.timeOfDeath=this.snapshot.timeOfDeath,this.integrateOnlyCounter=this.snapshot.integrateOnlyCounter,this.sprites[this.state].rollback()},p.prototype.setSprite=function(t,e){this.sprites[t]=e},p.prototype.render=function(t){if(this.sprites[this.state]){if(t.save(),t.translate(this.pos.x-this.size/2,this.pos.y-this.size/2),t.save(),!this.isAlive){var e=1-Math.max(0,(this.updateCount-this.timeOfDeath)/this.PERSISTENCE);e=.5>e?.5:1,t.globalAlpha=e}this.sprites[this.state].render(t,this.size,this.size),t.restore(),t.fillStyle="rgba(0,0,0,0.5)",this.SHOW_HEALTHBAR&&(t.fillRect(2,0,this.size-4,8),t.fillStyle="rgba(255,255,0,0.9)",t.fillRect(3,1,(this.size-6)*this.healthPoints/this.maxHealthPoints,6)),t.restore()}},p.prototype.canInteract=function(t){return this.team!=t.team?this.interactionType==this.NO_INTERACTION?!1:this.activity!=this.PASSIVE||t.provoked?this.interactionCount>=this.MAX_INTERACTION||t.pos.minus(this.pos).length()>=this.interactionDistance?!1:!0:!1:void 0},p.prototype.getInteractionType=function(t){this.interactionType==this.ATTACK_TYPE?t.setState(t.ATTACKING):this.interactionType==this.EAT_TYPE&&t.setState(t.EATING)},p.prototype.receiveDamage=function(t){l.prototype.receiveDamage.call(this,t)},p.prototype.update=function(t,e){this.updateCount++,this.sprites[this.state].update()},p.prototype.cleanUp=function(t,e){O(this,e)},p.prototype.garbageCollectible=function(){return l.prototype.garbageCollectible.call(this)},p.prototype.createSnapshot=function(){this.snapshot={state:this.state,lastAttack:this.lastAttack,healthPoints:this.healthPoints,isAlive:this.isAlive,updateCount:this.updateCount,interactionCount:this.interactionCount,timeOfDeath:this.timeOfDeath},this.sprites[this.state].createSnapshot()},p.prototype.rollback=function(){this.state=this.snapshot.state,this.lastAttack=this.snapshot.lastAttack,this.healthPoints=this.snapshot.healthPoints,this.isAlive=this.snapshot.isAlive,this.updateCount=this.snapshot.updateCount,this.timeOfDeath=this.snapshot.timeOfDeath,this.interactionCount=this.snapshot.interactionCount,this.sprites[this.state].rollback()},d.prototype=Object.create(c.prototype),d.prototype.receiveDamage=function(t){c.prototype.receiveDamage.call(this,t),this.isAlive||qt.numberOfFlocks[this.team]--},d.prototype.update=function(t,e){if(c.prototype.update.call(this,t,e),this.isAlive&&null==this.lockOnTarget){var i=this.team+1;i%=2,this.setLockOnTarget(qt.thrones[i],e)}},d.prototype.render=function(e){if(Zt.team!=this.team&&qt.hasFogOfWar){for(var i=!1,s=Math.floor(this.pos.y/qt.map.size),a=Math.floor(this.pos.x/qt.map.size),o=s-1;s+1>=o;++o){for(var n=a-1;a+1>=n;++n)if(!(0>o||0>n||o>=qt.map.height||n>=qt.map.width)){var r=o*qt.map.width+n,h=new t((n+.5)*qt.map.size,(o+.5)*qt.map.size);if(h.minus(this.pos).length()<1.5*this.radius&&0!=qt.map.fogOfWar[r]){i=!0;break}}if(i)break}i&&c.prototype.render.call(this,e)}else c.prototype.render.call(this,e)},m.prototype=Object.create(d.prototype),u.prototype=Object.create(p.prototype),u.prototype.update=function(t,e){if(p.prototype.update.call(this,t,e),this.isAlive&&!(this.updateCount-this.lastAttack<=this.ATTACK_DELAY)){this.lastAttack=this.updateCount;for(var i=0;i<t.length;++i)if(t[i].isAlive&&t[i].team!=this.team&&t[i].pos.minus(this.pos).length()<=this.attackRadius)return void qt.arrows.push(new this.weapon(this,t[i],this.strength));for(var i=Math.max(0,this.row-6);i<=Math.min(this.row+6,qt.map.height);++i)for(var s=Math.max(0,this.col-6);s<=Math.min(this.col+6,qt.map.width);++s){var a=qt.map.entry[i*qt.map.width+s];if(null!=a&&a.isAlive&&a.team!=this.team)return void qt.arrows.push(new this.weapon(this,a,this.strength))}}},u.prototype.render=function(t){if(Zt.team!=this.team&&qt.hasFogOfWar)for(var e=this.size/qt.map.size,i=this.row;i<this.row+e;++i)for(var s=this.col;s<this.col+e;++s){var a=i*qt.map.width+s;if(0!=qt.map.fogOfWar[a])return void p.prototype.render.call(this,t)}else p.prototype.render.call(this,t)},g.prototype=Object.create(u.prototype),f.prototype=Object.create(p.prototype),f.prototype.render=function(t){u.prototype.render.call(this,t)},f.prototype.createSnapshot=function(){A.prototype.createSnapshot.call(this)},f.prototype.rollback=function(){A.prototype.rollback.call(this)},f.prototype.update=function(t,e){p.prototype.update.call(this,t,e),this.updateCount-this.lastProduce<=this.PRODUCE_DELAY||(this.lastProduce=this.updateCount,qt.coins[this.team]+=this.coinsToHarvest,qt.isRedoing||qt.numbers.push(new H(this.pos,this.coinsToHarvest,22,"green",this.team)))},y.prototype=Object.create(f.prototype),v.prototype=Object.create(p.prototype),v.prototype.render=function(t){u.prototype.render.call(this,t)},v.prototype.canInteract=function(t){return p.prototype.canInteract.call(this,t)&&null!=t.lockOnTarget&&0==t.targetStack.length},E.prototype=Object.create(v.prototype),A.prototype=Object.create(p.prototype),A.prototype.render=function(t){u.prototype.render.call(this,t)},A.prototype.update=function(e,i){
if(p.prototype.update.call(this,e,i),this.isAlive&&!(qt.numberOfFlocks[this.team]>=jt.MAX_FLOCKS_PER_TEAM||this.updateCount-this.lastProduce<=this.PRODUCE_DELAY||qt.coins[this.team]<this.productPrice))for(var s=[[2,0],[2,1],[-1,0],[-1,1],[0,-1],[1,-1],[0,2],[1,2]],a=0;a<s.length;++a){var o=s[a][0]+this.row,n=s[a][1]+this.col;if(!(0>o||0>n||o>=qt.map.height||n>=qt.map.width)&&1==qt.map.data[o*qt.map.width+n]){for(var r=0;r<this.pigsPerProduction;++r)qt.coins[this.team]-=this.productPrice,this.lastProduce=this.updateCount,qt.numberOfFlocks[this.team]++,qt.flocks.push(new this.product(new t((n+.5)*qt.map.size,(o+.5)*qt.map.size),this.team)),qt.isRedoing||qt.numbers.push(new H(this.pos,this.productPrice,22,"red",this.team));return}}},A.prototype.createSnapshot=function(){p.prototype.createSnapshot.call(this),this.snapshot.lastProduce=this.lastProduce},A.prototype.rollback=function(){p.prototype.rollback.call(this),this.lastProduce=this.snapshot.lastProduce},I.prototype=Object.create(A.prototype),w.prototype=Object.create(p.prototype),w.prototype.render=function(t){u.prototype.render.call(this,t)},L.prototype=Object.create(c.prototype),L.prototype.render=function(t){d.prototype.render.call(this,t)},L.prototype.update=function(){if(this.updateCount++,this.isAlive){var t=17;this.pos=this.destination.minus(this.startPoint).times(Math.min(this.updateCount,this.maxDelta-t)/(this.maxDelta-t)).plus(this.startPoint),this.updateCount+t>=this.maxDelta&&(this.state=this.DEAD,this.target.receiveDamage(this.damage),this.damage=0),this.updateCount>=this.maxDelta&&(this.isAlive=!1,this.timeOfDeath=this.updateCount)}},L.prototype.createSnapshot=function(){c.prototype.createSnapshot.call(this),this.snapshot.updateCount=this.updateCount,this.snapshot.damage=this.damage},L.prototype.rollback=function(){c.prototype.rollback.call(this),this.updateCount=this.snapshot.updateCount,this.damage=this.snapshot.damage},_.prototype=Object.create(L.prototype),k.prototype.updatePosition=function(){var t=Zt.canvas.width,e=Zt.canvas.height;this.x=t/2,this.y=e-this.height/2},k.prototype.render=function(t){t.save(),this.updatePosition(),t.translate(this.x-this.width/2,this.y-this.height/2),t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,0,this.width,this.height);for(var e=0;e<this.icons.length;++e)this.icons[e].update(),this.icons[e].render(t);var i=40,s=i+.5*i*4+4+4,a=i+4;t.translate(-s,this.height-a),t.fillRect(0,0,s,a),t.drawImage(Yt.images["asset/pig_coin.png"],0,0,128,128,2,2,i,i),t.translate(i+4,0),t.fillStyle="rgba(255,245,200,0.5)",t.fillRect(1,3,s-i-4-2,a-6),t.translate(4,4);var o=x(qt.coins[Zt.team],32,"white");t.translate(s-i-8-o.width-.5*i/2,0),o.render(t),t.restore()},k.prototype.containsPoint=function(t,e){return this.x-this.width/2<=t&&t<=this.x+this.width/2&&this.y-this.height/2<=e&&e<=this.y+this.height/2},k.prototype.onclick=function(t,e){for(var i=t-(this.x-this.width/2),s=e-(this.y-this.height/2),a=0;a<this.icons.length;++a)if(this.icons[a].containsPoint(i,s))return void this.icons[a].onclick()},k.prototype.reset=function(){for(var t=0;t<this.icons.length;++t)this.icons[t].state="INACTIVE",this.icons[t].paid=!1;this.deselect.toCancel=!1},C.prototype.render=function(t){t.save(),"INACTIVE"==this.state?t.fillStyle="rgba(255,255,255,0.5)":"ACTIVE"==this.state&&(t.fillStyle="rgba(255,255,100,0.8)"),t.translate(this.x-this.width/2,this.y-this.height/2),t.fillRect(0,0,this.width,this.height),this.sprite.render(t,this.width,this.height),this.isLocked&&t.drawImage(Yt.images["asset/locked_icon.png"],0,0,128,128,0,0,this.width,this.height),("UNCLICKABLE"==this.state||"LOCKED"==this.state)&&(t.fillStyle="rgba(0,0,0,0.5)","LOCKED"==this.state&&(t.fillStyle="rgba(0,0,0,0.8)"),t.fillRect(0,0,this.width,this.height)),t.restore()},C.prototype.update=function(){},C.prototype.containsPoint=function(t,e){return k.prototype.containsPoint.call(this,t,e)},C.prototype.onclick=function(){if("UNCLICKABLE"!=this.state&&"LOCKED"!=this.state&&"ACTIVE"!=this.state){for(var t=0;t<Zt.menuBar.icons.length;++t)Zt.menuBar.icons[t].state="LOCKED";Zt.menuBar.deselect.state="INACTIVE",Zt.menuBar.deselect.toCancel=!0,this.state="ACTIVE"}},S.prototype=Object.create(C.prototype),S.prototype.update=function(){return"LOCKED"!=this.state&&"ACTIVE"!=this.state&&this.isAlive?this.cooldown>0?(this.state="UNCLICKABLE",void this.cooldown--):void(Kt[this.commandType]<=qt.coins[Zt.team]?this.state="INACTIVE":this.state="UNCLICKABLE"):void 0},S.prototype.onclick=function(){C.prototype.onclick.call(this),"ACTIVE"!=this.state||this.paid||(nt(Vt.BUY,[Zt.team,Vt[this.commandType],Kt[this.commandType],this.buildingSize]),Zt.menuBar.deselect.lockedCoins=Kt[this.commandType],this.cooldown=this.MAX_COOL_DOWN,this.paid=!0)},S.prototype.render=function(t){C.prototype.render.call(this,t),"LOCKED"!=this.state&&this.renderPrice(t,Kt[this.commandType])},S.prototype.renderPrice=function(t,e){t.save(),t.translate(this.x-this.width/2,this.y-this.height/2);var i=x(e,14,"white");t.translate(this.width-i.width-2,this.height-i.height-2),t.fillStyle="rgba(0,0,0,0.5)",t.fillRect(0,0,i.width,i.height),i.render(t),t.translate(-16,0),t.fillRect(0,0,16,14),t.drawImage(Yt.images["asset/pig_coin.png"],0,0,128,128,0,0,14,14),t.restore()},D.prototype=Object.create(S.prototype),D.prototype.update=function(){if("ACTIVE"==Zt.menuBar.upgrade.state){if(2==this.tier[Zt.team]||Kt[this.tierCommand]>qt.coins[Zt.team])return void(this.state="UNCLICKABLE");this.state="INACTIVE"}else S.prototype.update.call(this)},D.prototype.onclick=function(){if("ACTIVE"==Zt.menuBar.upgrade.state){if("UNCLICKABLE"==this.state)return;nt(Vt[this.tierCommand],[Zt.team]),this.cooldown=this.MAX_COOL_DOWN,Zt.menuBar.reset()}else S.prototype.onclick.call(this)},D.prototype.render=function(t){"ACTIVE"==Zt.menuBar.upgrade.state?(C.prototype.render.call(this,t),S.prototype.renderPrice.call(this,t,Kt[this.tierCommand])):S.prototype.render.call(this,t)},M.prototype=Object.create(S.prototype),M.prototype.update=function(){D.prototype.update.call(this)},M.prototype.onclick=function(){D.prototype.onclick.call(this)},M.prototype.render=function(t){D.prototype.render.call(this,t)},b.prototype=Object.create(S.prototype),B.prototype=Object.create(S.prototype),N.prototype=Object.create(C.prototype),N.prototype.update=function(){if("ACTIVE"!=this.state&&"LOCKED"!=this.state){if(qt.towerTier[Zt.team]+qt.ranchTier[Zt.team]>=4)return void(this.state="UNCLICKABLE");var t=1e9;1==qt.towerTier[Zt.team]&&(t=Math.min(t,Kt.UPGRADE_TOWER)),1==qt.ranchTier[Zt.team]&&(t=Math.min(t,Kt.UPGRADE_PIG_RANCH)),t>qt.coins[Zt.team]?this.state="UNCLICKABLE":this.state="INACTIVE"}},P.prototype=Object.create(S.prototype),P.prototype.update=function(){return 1==qt.towerTier[Zt.team]?void(this.state="UNCLICKABLE"):(this.isLocked=!1,void S.prototype.update.call(this))},U.prototype=Object.create(S.prototype),U.prototype.update=function(){return 1==qt.ranchTier[Zt.team]?void(this.state="UNCLICKABLE"):(this.isLocked=!1,void S.prototype.update.call(this))},z.prototype=Object.create(S.prototype),z.prototype.update=function(){return 1==qt.ranchTier[Zt.team]?void(this.state="UNCLICKABLE"):(this.isLocked=!1,void S.prototype.update.call(this))},F.prototype=Object.create(S.prototype),F.prototype.update=function(){return 1==qt.towerTier[Zt.team]?void(this.state="UNCLICKABLE"):(this.isLocked=!1,void S.prototype.update.call(this))},G.prototype=Object.create(C.prototype),G.prototype.onclick=function(){if(this.toCancel){for(var t=0;t<Zt.menuBar.icons.length;++t)"ACTIVE"==Zt.menuBar.icons[t].state&&(Zt.menuBar.icons[t].cooldown=0,Zt.menuBar.icons[t].paid=!1),Zt.menuBar.icons[t].state="INACTIVE";this.state="INACTIVE",nt(Vt.DESELECT,[Zt.team,this.lockedCoins]),this.lockedCoins=0,Zt.state="NONE",this.toCancel=!1}else"DESTROY"!=Zt.state?Zt.state="DESTROY":Zt.state="NONE"},G.prototype.update=function(){},H.prototype.render=function(t){if(this.isAlive&&this.team==Zt.team){if(this.delta>=this.MAX_DELTA)return void(this.isAlive=!1);t.save(),t.translate(this.pos.x-this.number.width/2,this.pos.y-this.number.height/2),this.number.render(t),this.pos.y-=1.2,t.restore(),this.delta++}},document.addEventListener("DOMContentLoaded",function(){W()});var Wt=io(),Yt={assetImageList:["asset/pig_running.png","asset/pig_standby.png","asset/pig_angry.png","asset/pig_eating.png","asset/pig_death.png","asset/boar_running.png","asset/boar_standby.png","asset/boar_attacking.png","asset/boar_eating.png","asset/boar_death.png","asset/tower.png","asset/tower_death.png","asset/castle.png","asset/castle_death.png","asset/rice_field.png","asset/rice_field_death.png","asset/super_rice_field.png","asset/pig_ranch.png","asset/pig_ranch_death.png","asset/pig_hq.png","asset/pig_hq_death.png","asset/block.png","asset/fence.png","asset/super_fence.png","asset/fence_death.png","asset/arrow.png","asset/arrow_death.png","asset/javelin.png","asset/javelin_death.png","asset/throne.png","asset/mouse.png","asset/mouse_shadow.png","asset/destroy.png","asset/tower_icon.png","asset/ranch_icon.png","asset/farm_icon.png","asset/fence_icon.png","asset/upgrade_icon.png","asset/castle_icon.png","asset/pighq_icon.png","asset/wall_icon.png","asset/farm_icon.png","asset/garden_icon.png","asset/deselect_icon.png","asset/pig_coin.png","asset/numbers.png","asset/locked_icon.png","asset/snow.png","asset/pigidow.jpg","asset/snowy-yosemite.jpg","asset/furpig-valley.jpg","asset/plus.png","asset/minus.png","asset/numbers-red.png","asset/numbers-green.png"],images:{},assetSoundList:[],sounds:{},loadedAssetCount:0},Vt={BUILD_TOWER:0,BUILD_FARM:1,BUILD_PIG_RANCH:2,BUILD_FENCE:3,UPGRADE_TOWER:4,UPGRADE_PIG_RANCH:5,BUY:6,DESELECT:7,BUILD_CASTLE:8,BUILD_GARDEN:9,BUILD_PIG_HQ:10,BUILD_WALL:11,SYNCHRONIZED:12,VICTORY:13,DESTROY:14},Kt={BUILD_TOWER:50,BUILD_FARM:5,BUILD_PIG_RANCH:50,BUILD_FENCE:5,UPGRADE_TOWER:600,UPGRADE_PIG_RANCH:800,BUILD_CASTLE:240,BUILD_GARDEN:35,BUILD_PIG_HQ:220,BUILD_WALL:40},jt={BACKGROUND_MONEY_RATE:300,MAX_COINS:9999,FPS:1e3/30,SCALER:1.5,SEND_DELAY:30,MAX_FLOCKS_PER_TEAM:50,ALLOWED_DELAY:300,RECOVERED_DELAY:150,CLOSE_BY:1,FAR_AWAY:2},Xt=[],qt={},Zt={camera:[0,0],mouse:[0,0],mouseImg:null,team:0,menuBar:null,gameEventHandlerResetFunction:null,state:"NONE",appState:"LOADING_FRAME",online:[],player:{},room:{},roomList:[],playingWithId:null,currentRoom:null,isHost:!1,isGameOngoing:!1,isSinglePlayer:!0,id:0},Qt={};[[[Vt.BUILD_PIG_RANCH,[0,2,0]],[Vt.BUILD_PIG_RANCH,[2,2,0]],[Vt.BUILD_FARM,[0,4,0]],[Vt.BUILD_FARM,[0,5,0]],[Vt.BUILD_FARM,[0,6,0]],[Vt.BUILD_FARM,[1,4,0]],[Vt.BUILD_FARM,[1,5,0]],[Vt.BUILD_FARM,[1,6,0]],[Vt.BUILD_FARM,[2,4,0]],[Vt.BUILD_FARM,[2,5,0]],[Vt.BUILD_TOWER,[6,1,0]]],[[Vt.BUILD_PIG_RANCH,[0,6,1]],[Vt.BUILD_PIG_RANCH,[2,6,1]],[Vt.BUILD_FARM,[0,8,1]],[Vt.BUILD_FARM,[0,9,1]],[Vt.BUILD_FARM,[0,10,1]],[Vt.BUILD_FARM,[1,8,1]],[Vt.BUILD_FARM,[1,9,1]],[Vt.BUILD_FARM,[1,10,1]],[Vt.BUILD_FARM,[2,8,1]],[Vt.BUILD_FARM,[2,9,1]],[Vt.BUILD_TOWER,[6,10,1]],[Vt.BUILD_TOWER,[4,10,1]],[Vt.BUILD_TOWER,[9,10,1]]]]}();